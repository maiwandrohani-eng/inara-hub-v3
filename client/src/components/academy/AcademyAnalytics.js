import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
// INARA Academy - Compliance Analytics Dashboard
import { useQuery } from 'react-query';
import { useState } from 'react';
import api from '../../api/client';
export default function AcademyAnalytics() {
    const [filterCountry, setFilterCountry] = useState('');
    const [filterDepartment, setFilterDepartment] = useState('');
    const { data, isLoading } = useQuery(['academy-analytics', filterCountry, filterDepartment], async () => {
        const params = new URLSearchParams();
        if (filterCountry)
            params.append('country', filterCountry);
        if (filterDepartment)
            params.append('department', filterDepartment);
        const res = await api.get(`/academy/analytics/compliance?${params.toString()}`);
        return res.data;
    });
    if (isLoading) {
        return (_jsx("div", { className: "text-center py-12 text-gray-400", children: "Loading analytics..." }));
    }
    const analytics = data || {};
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex justify-between items-center", children: [_jsxs("div", { children: [_jsx("h2", { className: "text-2xl font-bold text-white", children: "INARA Academy - Compliance Dashboard" }), _jsx("p", { className: "text-gray-400 text-sm mt-1", children: "Track training completion, expiry risks, and compliance by country/department" })] }), _jsxs("div", { className: "flex gap-2", children: [_jsxs("select", { value: filterCountry, onChange: (e) => setFilterCountry(e.target.value), className: "px-4 py-2 bg-gray-700 border border-gray-600 text-white rounded-lg", children: [_jsx("option", { value: "", children: "All Countries" }), analytics.countryStats?.map((cs) => (_jsx("option", { value: cs.country, children: cs.country }, cs.country)))] }), _jsxs("select", { value: filterDepartment, onChange: (e) => setFilterDepartment(e.target.value), className: "px-4 py-2 bg-gray-700 border border-gray-600 text-white rounded-lg", children: [_jsx("option", { value: "", children: "All Departments" }), analytics.departmentStats?.map((ds) => (_jsx("option", { value: ds.department, children: ds.department }, ds.department)))] })] })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-4 gap-4", children: [_jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-4", children: [_jsx("p", { className: "text-sm text-gray-400", children: "Total Users" }), _jsx("p", { className: "text-2xl font-bold text-white mt-1", children: analytics.summary?.totalUsers || 0 })] }), _jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-4", children: [_jsx("p", { className: "text-sm text-gray-400", children: "Completion Rate" }), _jsxs("p", { className: "text-2xl font-bold text-green-400 mt-1", children: [analytics.summary?.overallCompletionRate?.toFixed(1) || 0, "%"] })] }), _jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-4", children: [_jsx("p", { className: "text-sm text-gray-400", children: "Expired Certificates" }), _jsx("p", { className: "text-2xl font-bold text-red-400 mt-1", children: analytics.summary?.totalExpired || 0 })] }), _jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-4", children: [_jsx("p", { className: "text-sm text-gray-400", children: "Expiring Soon (30 days)" }), _jsx("p", { className: "text-2xl font-bold text-yellow-400 mt-1", children: analytics.summary?.totalExpiringSoon || 0 })] })] }), _jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-6", children: [_jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Course Completion Statistics" }), _jsx("div", { className: "space-y-4", children: analytics.courseStats?.map((course) => (_jsxs("div", { className: "bg-gray-700 rounded-lg p-4", children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsxs("div", { children: [_jsx("h4", { className: "text-white font-semibold", children: course.courseTitle }), _jsx("p", { className: "text-sm text-gray-400", children: course.courseType })] }), _jsxs("span", { className: "text-lg font-bold text-primary-400", children: [course.completionRate.toFixed(1), "%"] })] }), _jsxs("div", { className: "grid grid-cols-4 gap-4 mt-3 text-sm", children: [_jsxs("div", { children: [_jsx("p", { className: "text-gray-400", children: "Completed" }), _jsx("p", { className: "text-green-400 font-semibold", children: course.completed })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-400", children: "In Progress" }), _jsx("p", { className: "text-yellow-400 font-semibold", children: course.inProgress })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-400", children: "Not Started" }), _jsx("p", { className: "text-red-400 font-semibold", children: course.notStarted })] }), _jsxs("div", { children: [_jsx("p", { className: "text-gray-400", children: "Expired" }), _jsx("p", { className: "text-red-500 font-semibold", children: course.expired })] })] }), _jsx("div", { className: "mt-3 w-full bg-gray-600 rounded-full h-2", children: _jsx("div", { className: "bg-primary-500 h-2 rounded-full transition-all", style: { width: `${course.completionRate}%` } }) })] }, course.courseId))) })] }), analytics.countryStats && analytics.countryStats.length > 0 && (_jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-6", children: [_jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Compliance by Country" }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4", children: analytics.countryStats.map((country) => (_jsxs("div", { className: "bg-gray-700 rounded-lg p-4", children: [_jsx("h4", { className: "text-white font-semibold mb-2", children: country.country || 'Unknown' }), _jsxs("p", { className: "text-sm text-gray-400 mb-1", children: ["Users: ", country.totalUsers] }), _jsxs("p", { className: "text-sm text-gray-400 mb-2", children: ["Completions: ", country.totalCompletions] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-400", children: "Completion Rate" }), _jsxs("span", { className: "text-lg font-bold text-primary-400", children: [country.completionRate.toFixed(1), "%"] })] }), _jsx("div", { className: "mt-2 w-full bg-gray-600 rounded-full h-2", children: _jsx("div", { className: "bg-primary-500 h-2 rounded-full", style: { width: `${country.completionRate}%` } }) })] }, country.country))) })] })), analytics.departmentStats && analytics.departmentStats.length > 0 && (_jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-6", children: [_jsx("h3", { className: "text-xl font-bold text-white mb-4", children: "Compliance by Department" }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4", children: analytics.departmentStats.map((dept) => (_jsxs("div", { className: "bg-gray-700 rounded-lg p-4", children: [_jsx("h4", { className: "text-white font-semibold mb-2", children: dept.department }), _jsxs("p", { className: "text-sm text-gray-400 mb-1", children: ["Users: ", dept.totalUsers] }), _jsxs("p", { className: "text-sm text-gray-400 mb-2", children: ["Completions: ", dept.totalCompletions] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-400", children: "Completion Rate" }), _jsxs("span", { className: "text-lg font-bold text-primary-400", children: [dept.completionRate.toFixed(1), "%"] })] }), _jsx("div", { className: "mt-2 w-full bg-gray-600 rounded-full h-2", children: _jsx("div", { className: "bg-primary-500 h-2 rounded-full", style: { width: `${dept.completionRate}%` } }) })] }, dept.department))) })] })), analytics.trainingGaps && analytics.trainingGaps.length > 0 && (_jsxs("div", { className: "bg-gray-800 rounded-lg shadow border border-gray-700 p-6", children: [_jsxs("h3", { className: "text-xl font-bold text-white mb-4", children: ["Training Gaps (", analytics.trainingGaps.length, " users with missing mandatory trainings)"] }), _jsx("div", { className: "space-y-2 max-h-96 overflow-y-auto", children: analytics.trainingGaps.slice(0, 50).map((gap, idx) => (_jsxs("div", { className: "bg-gray-700 rounded-lg p-3", children: [_jsx("div", { className: "flex justify-between items-start", children: _jsxs("div", { children: [_jsx("p", { className: "text-white font-semibold", children: gap.userName }), _jsxs("p", { className: "text-sm text-gray-400", children: [gap.department, " \u2022 ", gap.country] }), _jsxs("p", { className: "text-sm text-red-400 mt-1", children: ["Missing ", gap.missingCount, " mandatory course(s)"] })] }) }), gap.missingCourses.length > 0 && (_jsxs("div", { className: "mt-2", children: [_jsx("p", { className: "text-xs text-gray-500", children: "Missing courses:" }), _jsxs("ul", { className: "text-xs text-gray-400 list-disc list-inside mt-1", children: [gap.missingCourses.slice(0, 3).map((course, cIdx) => (_jsx("li", { children: course }, cIdx))), gap.missingCourses.length > 3 && (_jsxs("li", { children: ["... and ", gap.missingCourses.length - 3, " more"] }))] })] }))] }, idx))) })] }))] }));
}
